generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Organizations {
  id         String            @id @default(uuid())
  name       String
  type       OrganizationsType

  attendance Attendance[]
  attendees  Attendees[]
  events     Events[]

  createdAt  DateTime          @default(now()) @map("created_at")
  updatedAt  DateTime          @updatedAt @map("updated_at")

  @@map("organizations")
}

model Attendees {
  id                 String                 @id @default(uuid())
  firstName          String                 @map("first_name")
  lastName           String                 @map("last_name")
  embedding          Unsupported("vector")?
  referenceImageUrl  String?                @map("reference_image_url")
  age                Int?
  email              String?
  status             String?
  address            String?
  birthday           String?
  invitedBy          String?                @map("invited_by")
  facebookName       String?                @map("facebook_name")
  facebookLink       String?                @map("facebook_link")
  cellLeader         String?                @map("cell_leader")
  memberStatus       MemberStatus?          @map("member_status")
  network            Network?
  churchHierarchy    ChurchHierarchy?       @map("church_hierarchy")
  churchProcess      ChurchProcess?         @map("church_process")
  disciples          Attendees[]            @relation("PrimaryLeaderRelation")
  eventRegistrations EventRegistrations[]
  gradeLevel         String?                @map("grade_level")
  section            String?

  attendance         Attendance[]

  primaryLeaderId    String?                @map("primary_leader_id")
  primaryLeader      Attendees?             @relation("PrimaryLeaderRelation", fields: [primaryLeaderId], references: [id])

  organizationId     String                 @map("organization_id")
  organization       Organizations          @relation(fields: [organizationId], references: [id])

  isArchived         Boolean                @map("is_archived") @default(false)
  createdAt          DateTime               @default(now()) @map("created_at")
  updatedAt          DateTime               @updatedAt @map("updated_at")

  @@unique([firstName, lastName])
  @@map("attendees")
}

model Events {
  id                 String               @id @default(uuid())
  name               String?
  image              String
  description        String
  tagline            String
  location           String
  category           EventCategory
  slug               String               @unique
  startDate          DateTime?            @map("start_date")
  endDate            DateTime?            @map("end_date")
  startTime          DateTime             @map("start_time")
  endTime            DateTime             @map("end_time")

  eventRegistrations EventRegistrations[]
  events             Attendance[]

  organizationId     String               @map("organization_id")
  organization       Organizations        @relation(fields: [organizationId], references: [id])

  isArchived         Boolean              @map("is_archived") @default(false)
  createdAt          DateTime             @default(now()) @map("created_at")
  updatedAt          DateTime             @updatedAt @map("updated_at")

  @@map("events")
}

model Attendance {
  id                  String              @id @default(uuid())
  timeIn              DateTime            @map("time_in")
  timeOut             DateTime?           @map("time_out")
  weekNumber          Int                 @map("week_number")
  isLate              Boolean             @map("is_late")
  occuranceDate       String              @map("occurance_date")

  attendeeId          String?             @map("attendee_id")
  attendee            Attendees?          @relation(fields: [attendeeId], references: [id])

  eventRegistrationId String?             @map("event_registration_id")
  eventRegistration   EventRegistrations? @relation(fields: [eventRegistrationId], references: [id])

  eventId             String?             @map("event_id")
  event               Events?             @relation(fields: [eventId], references: [id])

  organizationId      String              @map("organization_id")
  organization        Organizations       @relation(fields: [organizationId], references: [id])

  createdAt           DateTime            @default(now()) @map("created_at")
  updatedAt           DateTime            @updatedAt @map("updated_at")

  @@map("attendance")
}

model EventRegistrations {
  id         String       @id @default(uuid())

  attendance Attendance[]

  eventId    String       @map("event_id")
  event      Events       @relation(fields: [eventId], references: [id])

  attendeeId String       @map("attendee_id")
  attendee   Attendees    @relation(fields: [attendeeId], references: [id])

  createdAt  DateTime     @default(now()) @map("created_at")
  updatedAt  DateTime     @updatedAt @map("updated_at")

  @@unique([attendeeId, eventId])
  @@map("event_registrations")
}

enum OrganizationsType {
  CHURCH
  SCHOOL
}

enum EventCategory {
  RECURRING
  SPECIAL
}

enum ChurchHierarchy {
  CELL_MEMBER
  CELL_LEADER
  PRIMARY_LEADER
  ELDER
  PASTOR
  BISHOP
}

enum MemberStatus {
  FIRST_TIMER
  SECOND_TIMER
  THIRD_TIMER
  FOURTH_TIMER
  REGULAR_ATTENDEE
  REGULAR_DISCIPLE
  REGULAR_STARTUP
  BACK_TO_LIFE
  CELL_MEMBER
  CHILDREN
  NEWCOMER
}

enum ChurchProcess {
  PENDING
  START_UP_LESSON
  PRE_ENCOUNTER
  POST_ENCOUNTER
  SOL_1
  SOL_2
  SOL_3
  PASTORAL_MINISTRY
  UNDERCOVER
}

enum Network {
  CHILDREN
  YOUTH
  YOUNG_PRO
  MOTHER
  FATHER
  HUSBAND
  WIFE
}
